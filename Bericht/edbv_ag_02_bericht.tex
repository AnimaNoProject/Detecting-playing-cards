%%Berichtvorlage für EDBV WS 2014/2015

\documentclass[paper=A4, deutsch]{scrartcl}
\usepackage[ngerman]{babel}
\usepackage[utf8]{inputenc}
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{graphicx}
\usepackage{amsmath,amssymb}
\usepackage{subcaption}
\captionsetup{compatibility=false}
\usepackage{multirow}
\usepackage{color}
\usepackage[]{geometry}


\begin{document}


%%------------------------------------------------------
%% Ab hier tragt ihr eure Daten und Ergebnisse ein:
%%------------------------------------------------------

\title{Schnapskönig} %%Projekttitel hier eintragen

\subtitle{EDBV WS 2017/2018: AG\_A2} %%statt XX Arbeitsgruppenbezeichnung hier eintragen (zB.: A1)


%%Namen und Matrikelnummern der Gruppenmitglieder hier eintragen
\author{Jan Michael Lajarno (01425799)\\
Andreas Brunner (01429369)\\
Miran Jank (01526438)\\
Thorsten Korpitsch (01529243)\\
Aleksandar Marinkovic (01634028)\\
}


%%------------------------------------------------------

\maketitle


%%------------------------------------------------------
\section{Gewählte Problemstellung}
\subsection{Ziel}
Beim Schnappsen treten 2 Spieler gegeneinander an. Zu Beginn bekommt jeder 5 Karten vom Stapel, danach wird jede Runde von beiden Spielern eine Karte gezogen. Jede Runde wird jeweils 1 Karte von jedem Spieler auf den Tisch gelegt wobei beide Spieler versuchen einen Stich zu machen.
Stechen bedeutet, dass die eigene Karte entweder ein Adut ist und die Karte des gegenübers keines ist, beziehungsweise, dass die eigene Karte einen höheren Wert hat als die des Gegenübers. Es wird solange gespielt bis der Stapel leer ist und beide Spieler keine Karten mehr auf der Hand haben, beziehungsweise
einer der Spieler Karten im Wert von 66 Punkten gestochen hat. Sind alle Karten ausgespielt worden, wird der Gewinner ermittelt indem die gewonnenen Punkte beider Spieler gezählt werden und danach der mit der höheren Punktezahl gewinnt.
\subsection{Eingabe}
Der Benutzer muss pro Spielzug ein Farbbild, in einem gängigen Format(.PNG/.JPG/.JPEG), der Karten in das Programm laden.
\subsection{Ausgabe}
In der Konsole wird ein Zwischenstand nach jeder Runde ausgegeben, am Ende wird der Gewinner ausgegeben und der Endstand.
\subsection{Voraussetzungen und Bedingungen}
Ein Farbbild der Karten. Der Hintergrund sollte möglichst Einfarbig sein (nicht weiß, texturarm). Die Kamera soll sich in einem Winkel von 45 bis 135 Grad befinden. Die Karten müssen mit einem dünnen schwarzen Rand preperiert sein. Die obere Karte darf maximal 45\% der anderen Karte überdecken.
\subsection{Methodik}
\begin{enumerate}
	\item Threshold nach Otsu: Um in Kombination mit Zusammenhangskomponenten die Karten zu trennen
	\item Geometrische Transformation: Um das Eingabebild vorzubereiten wird aus dem, bis zu 45 Grad schrägen Bild, ein Bild aus der Vogelperspektive (90 Grad) transformiert, die hochkant steht
	\item Template-Matching: Um die Spielkarte zu identifizieren 
\end{enumerate}
\subsection{Evaluierung}
\begin{itemize}
	\item Werden beide Karten erkannt?
	\item Wird das Bild richtig transformiert, oder werden Buchstaben/Symbole verzerrt?
	\item Wird die Karte richtig identifiziert?
\end{itemize}

\subsection{Datenbeispiel}
\begin{figure}[h!]
 \centering
 \includegraphics[width=0.5\textwidth]{datenbeispiel.jpg}
 \caption{Karo-Ass sticht Kreuz-Koenig (Farbzwang), 16 Punkte gewonnen}
 \label{fig:img}
\end{figure}
\begin{figure}[h!]
 \centering
 \includegraphics[width=0.5\textwidth]{datenbeispiel2.jpg}
 \caption{Karo-K\"onig sticht Karo-Dame, 7 Punkte gewonnen}
 \label{fig:img}
\end{figure}

\newpage

\subsection{Zeitplan}
\begin{table}[h!]
	\centering
		\begin{tabular}{|c|c|c|c|c|}
		\hline
		Meilenstein & \multicolumn{2}{c|}{abgeschlossen am} & \multicolumn{2}{c|}{Arbeitsaufwand in h}\\
		\cline{2-5}
		 & geplant & tatsächlich & geplant & tatsächlich\\
		\hline
		Vorarbeit Projekt& 20.10.2017 & 21.10.2017 & 20 & 23\\
		Prototyp erstellen& 10.11.2017& 01.12.2017 & 40 & 80\\
		Geometrische Transformation& 22.12.2017& 27.12.2017 & 105  & 92 \\
		Threshold nach Otsu& 18.12.2017& 25.12.2017 & 67 & 60 \\
		Pattern-Matching & 18.12.2017 &30.12.2017 & 43 & 30\\
		GT-Test & 31.12.2017& 31.12.2017 & 10  & 12 \\
		TH-Test & 27.12.2017 & 29.12.2017 & 5 & 5 \\
		PM-Test & 27.12.2017& 29.12.2017 & 5 & 3 \\
		Unit-Test & 05.01.2017& 04.01.2017 & 5 & 2 \\
		\hline
		\end{tabular}
\end{table}
%%------------------------------------------------------

%%------------------------------------------------------

 \newpage

\section{Arbeitsteilung}
\begin{center}
  \begin{tabular}{ |l |p{0.7\linewidth} | }
    \hline
  Name & Tätigkeiten\\
    \hline
		Jan Michael Lajarno & Matlab: Prototyp, ausführbares Programm, \newline Bericht: Methodik/Implementierung(Template Matching), Gewählte Problemstellung\\
		\hline
		Andreas Brunner & Matlab: Prototyp, tmc.m \newline Bericht: Arbeitsteilung, Evaluierung\\
		\hline
		Miran Jank & Matlab: geometricTransform \newline Bericht: Methodik(Geometrische Transformation)\\
		\hline
		Thorsten Korpitsch & Matlab: Prototyp, splitCards.m, thresholdOtsu.m \newline Bericht: Evaluierung, Methodik/Implementierung (Threshold nach Otsu), Schlusswort\\
		\hline
		Aleksandar Marinkovic & Matlab: Prototyp, geometricTransform \newline Bericht: Implementierung(Geometrische Transformation)\\ 
		\hline
  \end{tabular}
\end{center}

%%------------------------------------------------------

%%------------------------------------------------------
\section{Methodik}
(2-3 Seiten)\\
Hier wird die verwendete Methodik in der Theorie vorgestellt:\\
Welche Methodik wurde verwendet? Warum eignet sich diese Methodik für die gewählte Problemstellung? Habt ihr Methoden verändert (Einschränkungen, Abwandlungen), wenn ja wie? etc.\\
Die erwähnten Methoden werden zum größten Teil auf Beschreibungen in Büchern oder wissenschaftlichen Artikeln beruhen. Daher ist hier auch der richtige Platz für Zitate. Die hier zitierten Publikationen sollten mittels Abkürzung bzw. Nummer referenziert sein und sich in der Referenzliste am Ende des Berichts über diese Bezeichnung finden lassen.\\
Ein Beispielsatz (inkl. entsprechender Literaturangabe am Ende des Berichts): Interest Points wurden mittels Scale Invariant Feature Transform detektiert.\\
Bei der Verwendung von Latex gestaltet sich das Zitieren besonders einfach - siehe Beispielssatz im Source der Latex-Vorlage.\\

\textbf{Wichtig in diesem Abschnitt ist, dass sich der Leser eures Berichts mit den verwendeten Methodiken auskennen und wissen, weshalb ihr diese Methodiken verwendet habt und keine anderen. Es soll dem Leser helfen den nächsten Abschnitt des Berichts besser zu verstehen.}
\subsection{Threshold nach Otsu}
Die Aufgabe für die erste verwendete Methode ist das Trennen der Karten vom Hintergrund. Hier haben wir uns für ein Schwellenwertverfahren entschieden. Bei einem Schwellenwertvefahren wird
ein Graustufenbild in ein Bin\"aerbild umgewandelt. Wir haben uns f\"uer den Threshold nach Otsu entschieden, da es in der Kombination mit der Zusammenhangskomponente besonders dazu eignet 
um Objekte vom Hintergrund zu trennen. 

Beim Threshold nach Otsu wird versucht, die beiden Segmente (Vordergrund/Hintergrund) so kompakt wie möglich zu machen und die Überschneidung gering zu halten.

Um das Trennen der Karten zu vereinfachen schränken wir die Eingabe dahingehend ein, dass beim Bild der Karten der Hintergrund nicht weiß sein darf und möglichst texturarm. Diese 
Einschränkungen machen unseren Threshold nach Otsu stabiler und sehr erfolgssicher beim Trennen der Karten vom Hintergrund.
\subsection{Geometrische Transformation}

\subsection{Template-Matching}
Um die Karte schlussendlich zu identifizieren haben wir uns für das Template Matching entschieden. Das Template-Matching bietet genau die Lösung zu unserer letzten Problemstellung.
Mithilfe des Template-Matching versuchen wir herauszufinden ob es sich bei der Karte um Herz, Pik, Kreuz oder Karo handelt und ob es sich um Ass, K\"onig\, Dame, Bube oder Zehn handelt.
Aus der Kombination dieser beiden Symbole k\"onnen wir die Karte eindeutig identifizieren.

Beim Template-Matching wird versucht ein Bild beziehungsweise einen Bildausschnitt in einem anderen Bild wiederzufinden. User Template-Matching wird mittels einer Correlation-Matrix realisiert,
es wird druch alle Möglichkeiten durchiteriert und das passenste wird der Karte zugewiesen.
%%------------------------------------------------------

%%------------------------------------------------------
\section{Implementierung}
(1-X Seiten)\\
Hier gebt ihr einen Überblick über eure Implementierung:\\
Wie habt ihr die im vorhergehenden Abschnitt vorgestellte Methodik praktisch umgesetzt? Wie werden die einzelnen Methoden kombiniert (zB. Implementierungspipeline)?\\
Hier ist Platz für Implementierungsdetails wie zB. gewählte Parameter. \\
Wie startet der User das Programm? Welche Parameter hat der User zu setzen?\\
Auch in diesem Abschnitt können Referenzen und Zitate notwendig sein.\\
\textbf{Wichtig in diesem Abschnitt ist, dass der Leser eures Berichts versteht wie ihr euer Projekt in MATLAB umgesetzt habt um sich auch im Quelltext leichter zurechtfinden zu können.}

\subsection{Vorverarbeitung}
Zuerst wird der Datensatz geladen und in ein Graustufenbild umgewandelt.
%% wie ladet man den datensatz

\subsection{Karten trennen}
Der Thershold ist die erste Methodik in der Methodik-Pipeline, in Kombination mit der Zusammenhangskomponente. Der Funktion splitCards.m wird das Eingabebild \"ubergeben. 
Als erstes wird dieses in ein Graustufenbild umgewandelt und an die Funktion thresholdotsu.m \"ubergeben. 

Dort werden zuerst die aufkommenden Grauwerte gez\"ahlt mittles der histcounts-Funktion. Danach wird die gewichtete Summe aller Pixel berechnet, indem man die Anzahl der Pixel mit ihrem jeweiligen Grauwert multipliziert.
Danach wird in einer for-Schleife durch alle Grauwerte durchiteriert. In jedem Schleifendurchgang werden die Pixel, die den aktuellen Grauwert besitzen,
zum Hintergrund dazugerechnet. Der Vordergrund wird neu berechnet indem von der Summe der Pixel, die Pixel vom Hintergrund abzieht. 
Danach wird die Gewichtete Summe des Hintergrunds berechnet, analog dazu, wie am Beginn die gewichtete Summe aller Pixel berechnet wurde.
Jetzt k\"onnen die Durchschnittswerte des Hinter- und Vordergrunds berechnet werden. Als vorletzten Schritt berechnen wir die Between Class Variance.
\\
Als letztes wird \"uberpr\"uft ob die Between Class Variance, die bisher gr\"o\"ste ist. Ist das der Fall, wird der Threshold auf den aktuell iterierten
Grauwert gesetzt und die maximale Between Class Variance auf die gerade berechnete gesetzt.
Nach dem durchlaufen der Schleife, wird das Bild mittels des optimalen Thresholds in ein Bin\"arbild umgewandelt.

\begin{figure}[h!]
 \centering
 \includegraphics[width=0.5\textwidth]{otsu_example.PNG}
 \caption{Bin\"arbild mittels Threshold nach Otsu}
 \label{fig:img}
\end{figure}

Auf dieses Bin\"arbild wird die Zusammenhangskomponente angewendet um die Karten zu trennen. Aus den 2 gr\"o\"sten Zusammenhangskomponenten 
werden 2 Bilder erstellt, die die Karten repr\"asentieren. Bei diesen werden noch die L\"ocher gef\"ullt. Dies passiert,
da wir nicht nur die Karten trennen wollen, sondern auch gleichzeit herausfinden wollen, welche Karte die Obere und welche die Untere ist.
Das ganze berechnen wir ganz einfach indem wir die Fl\"ache beider Karten vergleichen und die Karte mit der gr\"o\"seren Fl\"ache die sein muss,
die oben liegt, da sie ja einen Teil der unteren Karte verdeckt. Das F\"ullen der L\"ocher funktioniert vorallem bei Bildkarten unterschiedlich gut,
wie man im nachfolgenden Bild erkennen kann, das kann zu Problemen f\"uhren bei der Erkennung welche Karte die Obere und welche die Untere ist.

\begin{figure}[h!]
 \centering
 \includegraphics[width=0.8\textwidth]{splitCards_example.PNG}
 \caption{Bin\"arbilder der getrennten Karten als Montage. Dame(links), K\"onig(rechts)}
 \label{fig:img}
\end{figure}

Danach werden beide Karten an die 2. Methodik weitergegeben, die geometrische Transformation.

%%------------------------------------------------------

%%------------------------------------------------------
\newpage

\section{Evaluierung}
(2-X Seiten)\\
Hier stellt ihr euren Datensatz vor und beantwortet Evaluierungsfragen:\\
z.B. Fakten zum Datensatz: Anzahl der Bilder, Größe der Bilder, Quelle des Datensatzes (falls selbst aufgenommen: Aufnahmegerät, Einstellungen,... / falls nicht selbst erstellt: Datenbank vostellen... $\to$ Referenzen!)\\
Diskussion der Evaluierungsfragen: Beantwortung der Fragen, Diskussion anhand von Beispielen, Diskussion von Grenzfällen: für welche Bilder funktioniert die Implementierung, für welche nicht? Worin unterscheiden sich diese Bilder? Warum funktionieren sie nicht? etc.\\
Evaluiert wird der ganze Datensatz, nicht nur einzelne Bilder. Einzelne Bilder können zum Aufzeigen von Fehlern/Problemen/besonders guten Ergebnissen... genutzt werden.\\
Zur Evaluierung gehört auch das Testen der einzelnen Methodiken (separat), mit Erwähnung eventueller Einschränkungen.
%%------------------------------------------------------

%%------------------------------------------------------
\section{Schlusswort}
Unsere Schlussfolgerung ist, dass der Anfang des Projekts, also das finden geeigneter Methoden um unsere Problem zu lösen,
beziehungsweise einen ersten Prototypen zu entwickeln der schwierigste Schritt für uns waren. Insbesondere das finden der Karten
auf dem Bild, bzw. die Findung der Kanten und Ecken um eine Geometrische Transformation im naechsten Schritt zu ermoeglichen.
Sobald das erledigt war und wir beim Prototyping eine Methode (Canny-Edge-Detection) gegen eine andere ausgetauscht hatten (Threshold nach Otsu)
ging es sehr zuegig voran und wir konnten die Zeit die wir aufholen, welche wir beim Prototyping verloren hatten.

Zurzeit gibt es noch Probleme, wenn der Hintergrund zu hell ist, werden die Karten teilweise nicht getrennt,
da unser Programm die Karten mittels Threshold nach Otsu und der Zusammenhangskomponente trennt. Wird 
dann der Hintergrund als Vordergrund erkannt und ist eine gr\"o\"sere Zusammenhangskomponente als die kleinere Karte, wird diese nicht mehr erkannt
und stattdessen wird der Hintergrund als 2. Karte erkannt.
%%Mehr Probleme hier

Eine grosse Verbesserung unserer Loesung waere, wenn die Karten nicht mit einem schwarzen Rand
praepariert werden muessten. Beziehungsweise wenn man einen Schritt weiter geht, dass nicht ein
bestimmtes Kartendeck verwendet werden muss, sondern ein beliebiges (Kartedecks unterscheiden sich oft
in der Symbolik, was bei uns dazu fuehrt, dass die Karten nicht mehr richtig identifiziert werden).
%%------------------------------------------------------

%%------------------------------------------------------
\bibliographystyle{plain}
\bibliography{edbv_lit}
%%Bei verwendung von Latex schreibt ihr eure Referenzen in ein eigenes bib-File (siehe hier edbv_lit.bib). Jene Referenzen, die ihr im Bericht mittels \cite zitiert, werden automatisch in die Referenzliste übernommen. Weitere Information zum Einbinden von BibTex gibt es hier: http://www.bibtex.org/Using/de/
%%------------------------------------------------------

\end{document}
\grid
\grid
